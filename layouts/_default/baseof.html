<!DOCTYPE html>
<html lang="{{ $.Site.LanguageCode | default "en" }}">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <title>{{ block "title" . }}{{ with .Params.Title }}{{ . }} | {{ end }}{{ .Site.Title }}{{ end }}</title>
    <meta name="description" content="{{ with .Description }}{{ . }}{{ else }}{{if .IsPage}}{{ .Summary }}{{ else }}{{ with .Site.Params.description }}{{ . }}{{ end }}{{ end }}{{ end }}">
    {{ hugo.Generator }}
    
    <!-- Load Ananke theme CSS with proper processing -->
    {{ $sass := resources.Get "ananke/css/main.css" }}
    {{ if $sass }}
      {{ $style := $sass | resources.ExecuteAsTemplate "main.css" . }}
      {{ if hugo.IsProduction }}
        {{ $cssOpts := (dict "targetPath" "css/main.css" "enableSourceMap" false) }}
        {{ $style = $style | resources.ToCSS $cssOpts | resources.Minify }}
      {{ end }}
      <link rel="stylesheet" href="{{ $style.RelPermalink }}">
    {{ end }}

    <!-- VoSai Custom CSS with higher priority -->
    {{ $vosaiCSS := resources.Get "css/vosai-custom.css" }}
    {{ if $vosaiCSS }}
      {{ if hugo.IsProduction }}
        {{ $vosaiCSS = $vosaiCSS | resources.Minify }}
      {{ end }}
      <link rel="stylesheet" href="{{ $vosaiCSS.RelPermalink }}">
    {{ end }}

    <!-- VoSai branding -->
    <link rel="icon" type="image/png" href="/images/vosai-logo.png">
    <link rel="apple-touch-icon" href="/images/vosai-logo.png">
    <meta name="theme-color" content="#0a0a0a">
    
    <!-- Include theme favicon partial safely -->
    {{ if templates.Exists "partials/site-favicon.html" }}
      {{ partials.Include "site-favicon.html" . }}
    {{ end }}
  </head>

  <body class="{{ $.Param "body_classes" | default "ma0 avenir bg-near-black" }}">
    {{ block "header" . }}{{ partials.Include "site-header.html" . }}{{ end }}
    <main class="pb7" role="main">
      {{ block "main" . }}{{ end }}
    </main>
    {{ block "footer" . }}{{ partials.Include "site-footer.html" . }}{{ end }}
  </body>
</html>
